{% extends "layout.njk" %}

{% from "table/macro.njk" import govukTable %}
{% from "warning-text/macro.njk" import govukWarningText %}
{% from "inset-text/macro.njk" import govukInsetText %}
{% from "summary-list/macro.njk" import govukSummaryList %}
{% from "back-link/macro.njk" import govukBackLink %}

{% set title = mssgs.licence_details_title %}
{% block pageTitle %}{{ title }}{{ mssgs.gov_uk }}{% endblock %}

{% block content %}
<div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds">
        {{ govukBackLink({
              text: mssgs.back,
              href: backRef,
              classes: "govuk-!-margin-bottom-7 no-print"
        }) }}
        <section class="no-print">
            <h1 class="govuk-heading-xl">{{ title }}</h1>

            <p class="govuk-body-l">
                {{ mssgs.licence_details_body_1 }}
            </p>

            <p class="govuk-body-l">
                {{ mssgs.licence_details_body_2 }}
            </p>
        </section>

        <section class="pagebreak">

            <img src="/public/images/EA-logo-black.png" class="print-area ea-logo">

            {% for licence in data.licences %}
                {% if licence.length === '1D' %}
                    {% set lengthText = mssgs.licence_type_1d %}
                {% elseif licence.length === '8D' %}
                    {% set lengthText = mssgs.licence_type_8d %}
                {% else %}
                    {% set lengthText = mssgs.licence_type_12m %}
                {% endif %}

                {% if licence.ageConcession %}
                    {% if licence.ageConcession.type == mssgs.senior %}
                        {% set ageConcessionText = mssgs.age_senior_concession %}
                    {% elseif licence.ageConcession.type == mssgs.age_junior %}
                        {% set ageConcessionText = mssgs.age_junior_concession %}
                    {% endif%}
                {% endif%}

                {% set licenseDetailsSummaryRows = [] %}
                    {{ licenseDetailsSummaryRows.push({ key: { text: mssgs.licence_summary_name }, value: { text: licence.licenceHolder } }) }}
                    {{ licenseDetailsSummaryRows.push({ key: { text: mssgs.identification }, value: { text: licence.obfuscatedDob } }) }}
                    {{ licenseDetailsSummaryRows.push({ key: { text: mssgs.licence_summary_type }, value: { text: licence.type } }) }}
                    {{ licenseDetailsSummaryRows.push({ key: { text: mssgs.licence_summary_length }, value: { text: lengthText } }) }}
                    {{ licenseDetailsSummaryRows.push({ key: { text: mssgs.starts }, value: { text: licence.start } }) }}
                    {{ licenseDetailsSummaryRows.push({ key: { text: mssgs.ends }, value: { text: licence.end } }) }}
                    {{ licenseDetailsSummaryRows.push({ key: { text: mssgs.licence_summary_disability_concession }, value: { text: mssgs.yes } }) if licence.disabled }}
                    {{ licenseDetailsSummaryRows.push({ key: { text: mssgs.age_concession }, value: { text: ageConcessionText } }) if licence.ageConcession }}
                
                <h2 class="govuk-heading-l">{{ licence.referenceNumber }}</h2>

                {{ govukSummaryList({
                    rows: licenseDetailsSummaryRows
                }) }}

            {% endfor %}

            {{ govukInsetText({
                html: mssgs.licence_details_no_print_1 + '<br/>' + mssgs.licence_details_no_print_2 + '<a href="https://www.gov.uk/guidance/national-rod-fishing-byelaws-for-england-freshwater-fishing-with-a-rod-and-line" class="govuk_link">' + mssgs.licence_details_no_print_link + '</a>' + mssgs.licence_details_no_print_3,
                classes: "no-print"
            }) }}

            {{ govukInsetText({
                html: mssgs.licence_details_print_area_1 + '<br/>' + mssgs.licence_details_print_area_2,
                classes: "print-area"
            }) }}

            {{ govukWarningText({
                html: mssgs.licence_details_warning_1 + '<br />' + mssgs.licence_details_warning_2,
                iconFallbackText: "Warning",
                classes: "govuk-!-margin-top-6"
            }) }}
        </section>
    </div>
</div>
{% endblock %}
