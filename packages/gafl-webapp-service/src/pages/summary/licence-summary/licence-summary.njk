{% extends "layout.njk" %}

{% from "summary-list/macro.njk" import govukSummaryList %}
{% from "fieldset/macro.njk" import govukFieldset %}
{% from "warning-text/macro.njk" import govukWarningText %}
{% from "button/macro.njk" import govukButton %}
{% from "back-link/macro.njk" import govukBackLink %}

{% set title = mssgs.licence_summary_title %}
{% block pageTitle %}{{ title }}{{ mssgs.gov_uk }}{% endblock %}

{% set licenseDetailsSummaryRows = [
    {
      key: {
        text: mssgs.licence_summary_name
      },
      value: {
        text: data.permission.licensee.firstName + ' ' + data.permission.licensee.lastName
      },
      actions: {
        items: [
          {
            href: data.uri.name,
            text: mssgs.licence_summary_change,
            visuallyHiddenText: "name",
            attributes: { id: 'change-name' }
          }
        ]
      }
    }
  ]
%}


{% if not data.isRenewal %}
    {{ licenseDetailsSummaryRows.push({
        key: {
            text: mssgs.licence_summary_dob
        },
        value: {
            text: data.birthDateStr
        },
        actions: {
            items: [{
                href: data.uri.dateOfBirth,
                text: mssgs.licence_summary_change,
                visuallyHiddenText: "date of birth",
                attributes: { id: 'change-birth-date' }
            }]
        }
    }) }}
{% endif %}

{{ licenseDetailsSummaryRows.push({
    key: {
      text: mssgs.licence_summary_type
    },
    value: {
      text: data.licenceTypeStr
    },
    actions: {
      items: [
        {
          href: data.uri.licenceType,
          text: mssgs.licence_summary_change,
          visuallyHiddenText: "type",
          attributes: { id: 'change-licence-type' }
        }
      ]
    }
}) }}

{{ licenseDetailsSummaryRows.push({
  key: {
    text: mssgs.licence_summary_length
  },
  value: {
    text: mssgs.licence_type_12m if data.permission.licenceLength === '12M' else (mssgs.licence_type_8d if data.permission.licenceLength === '8D' else mssgs.licence_type_1d)
  },
  actions: {
    items: [
      {
        href: data.uri.licenceLength,
        text: mssgs.licence_summary_change,
        visuallyHiddenText: "length",
        attributes: { id: 'change-licence-length' }
      }
    ] if not data.hasJunior and not data.isRenewal
  }
}) }}

{{ licenseDetailsSummaryRows.push({
      key: {
        text: mssgs.licence_summary_start_date
      },
      value: {
        html: data.startAfterPaymentMinutes + mssgs.licence_summary_minutes_after_payment if data.permission.licenceToStart === 'after-payment' else data.startTimeString +
        ('</br><span class="govuk-caption-m">' + mssgs.licence_summary_immediately_after_expire + '</span>' if data.isContinuing and data.isRenewal else '')
      },
      actions: {
        items: [
          {
            href:  data.uri.licenceStartDate if data.isRenewal else data.uri.licenceToStart,
            text: mssgs.licence_summary_change,
            visuallyHiddenText: "start date",
            attributes: { id: 'change-licence-to-start' }
          }
        ]
      }
}) }}

{% if data.permission.licenceLength === '12M' %}
    {% set concessionText = mssgs.licence_summary_blue_badge_num if data.disabled.proof.type === data.concessionProofs.blueBadge else (mssgs.licence_summary_ni_num if data.disabled.proof.type === data.concessionProofs.NI else mssgs.licence_summary_disability_concession) %}
    {{ licenseDetailsSummaryRows.push({
      key: {
        text: concessionText
      },
      value: {
        html: data.disabled.proof.referenceNumber if data.disabled else '<span>' + mssgs.licence_summary_none + '</span>'
      },
      actions: {
        items: [
          {
            href: data.uri.disabilityConcession,
            text: mssgs.licence_summary_change,
            visuallyHiddenText: concessionText,
            attributes: { id: 'change-benefit-check' }
          }
        ]
    }
    }) }}
{% endif %}

{{ licenseDetailsSummaryRows.push({
  key: {
    text: "Cost"
  },
  value: {
    text: "Â£" + data.cost if data.cost else "free"
  }
}) }}

{% set licenseDetailsSummary %}
    {% call govukFieldset({
      legend: {
        text: title,
        classes: "govuk-fieldset__legend--l govuk-!-margin-bottom-3",
        isPageHeading: true
      }
    }) %}
    {{ govukSummaryList({ 
      classes: 'licence-summary-list',
      rows: licenseDetailsSummaryRows 
    }) }}
    {% endcall %}
{% endset -%}

{% block content %}
<div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds">
        {% if backRef %}
            {{ govukBackLink({
              text: mssgs.back,
              href: backRef,
              classes: "govuk-!-margin-bottom-7"
            }) }}
        {% endif %}
        <form method="post">
            {{ licenseDetailsSummary | trim | safe }}

            {{ govukButton({
                attributes: { id: 'continue' },
                preventDoubleClick: true,
                name: "continue",
                text: mssgs.continue,
                classes: "govuk-!-margin-top-5"
            }) }}

            {{ csrf() }}
        </form>
        {% if data.isRenewal %}<a class="govuk-link" class="govuk-link" href="{{ data.uri.clear }}">{{ mssgs.buy_different_licence }}</a>{% endif %}
    </div>
</div>
{% endblock %}





